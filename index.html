<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Testlik – Anket Çöz, Puan Kazan</title>
  <meta name="description" content="Giriş yap, anket çöz, puan kazan! Testlik, mobil uyumlu ve hızlı anket platformudur." />
  <link rel="canonical" href="https://testlik.com/" />
  <meta name="robots" content="index,follow" />
  <!-- Open Graph -->
  <meta property="og:title" content="Testlik – Anket Çöz, Puan Kazan" />
  <meta property="og:description" content="Kocaman butona tıkla; rastgele anket çöz ve puan kazan!" />
  <meta property="og:url" content="https://testlik.com/" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://testlik.com/assets/og-banner.jpg" />
  <!-- AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
  <!-- (Opsiyonel) Freestone SDK’nı burada yükle -->
  <!-- <script src="https://cdn.freestone.example/sdk.min.js" defer></script> -->
  <link rel="icon" href="/assets/logo.png" />
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <!-- NAVBAR -->
  <header class="navbar" role="banner">
    <a class="logo" href="/" aria-label="Testlik Ana Sayfa">🗳️ Testlik</a>
    <nav class="topnav" aria-label="Ana menü">
      <a href="/" aria-current="page">Anketler</a>
      <a href="/puan.html">Puanlarım</a>
      <a href="/oduller.html">Ödüller</a>
    </nav>
    <button id="authBtn" class="btn ghost" aria-label="Giriş Yap">Giriş</button>
  </header>

  <!-- Üst Reklam -->
  <div class="ad ad-top" aria-label="Üst reklam">
    <ins class="adsbygoogle"
         style="display:block;text-align:center"
         data-ad-client="ca-pub-XXXXXXXXXXXXXXX"
         data-ad-slot="1234567890"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>

  <!-- HERO -->
  <section class="hero" role="region" aria-label="Hızlı başla">
    <h1>Anket Çöz, Puan Kazan</h1>
    <p>Butona tıkla, rastgele bir ankete ışınlan 🎯</p>
    <button id="randomPoll" class="btn big" aria-label="Rastgele anket çöz">📝 Anket Çöz – Puan Kazan</button>
  </section>

  <!-- İÇERİK + YAN REKLAMLAR -->
  <main class="wrap" role="main">
    <aside class="ad ad-side left" aria-label="Sol reklam">
      <ins class="adsbygoogle"
           style="display:block;width:160px;height:600px"
           data-ad-client="ca-pub-XXXXXXXXXXXXXXX"
           data-ad-slot="2345678901"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </aside>

    <section class="grid-area" aria-label="Popüler anketler">
      <h2 class="sr-only">Popüler Anketler</h2>
      <div id="pollGrid" class="grid" role="list"></div>
    </section>

    <aside class="ad ad-side right" aria-label="Sağ reklam">
      <ins class="adsbygoogle"
           style="display:block;width:160px;height:600px"
           data-ad-client="ca-pub-XXXXXXXXXXXXXXX"
           data-ad-slot="2345678901"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </aside>
  </main>

  <!-- ALT REKLAM + YASAL LİNKLER -->
  <footer class="footer" role="contentinfo">
    <div class="ad ad-footer" aria-label="Alt reklam">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-XXXXXXXXXXXXXXX"
           data-ad-slot="3456789012"
           data-ad-format="link"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>

    <nav class="legal">
      <a href="/privacy.html">Gizlilik</a>
      <span>·</span>
      <a href="/terms.html">Kullanım Şartları</a>
      <span>·</span>
      <a href="/contact.html">İletişim</a>
    </nav>
    <small>© <span id="yil"></span> Testlik</small>
  </footer>

  <!-- Sayfaya özel JS -->
  <script>
  // --- Basit Freestone entegrasyon noktası (fallback: localStorage) ---
  function isLoggedIn() {
    // Freestone SDK varsa:
    if (window.freestone?.auth?.currentUser) return true;
    // Yoksa localStorage simülasyonu:
    return localStorage.getItem('fsLogged') === '1';
  }

  async function loginWithFreestone() {
    if (window.freestone?.signIn) {
      try { await window.freestone.signIn(); return true; } catch(e) { console.warn(e); return false; }
    } else {
      // fallback demo
      localStorage.setItem('fsLogged', '1'); return true;
    }
  }

  async function logoutWithFreestone() {
    if (window.freestone?.signOut) {
      try { await window.freestone.signOut(); } catch(e) { console.warn(e); }
    }
    localStorage.removeItem('fsLogged');
  }

  function updateAuthUI() {
    const btn = document.getElementById('authBtn');
    const logged = isLoggedIn();
    btn.textContent = logged ? 'Çıkış' : 'Giriş';
    btn.setAttribute('aria-label', logged ? 'Çıkış Yap' : 'Giriş Yap');
  }

  document.getElementById('authBtn').addEventListener('click', async () => {
    if (isLoggedIn()) { await logoutWithFreestone(); }
    else { await loginWithFreestone(); }
    updateAuthUI();
  });
  updateAuthUI();

  // --- Yıl ---
  document.getElementById('yil').textContent = new Date().getFullYear();

  // --- Kocaman buton: rastgele anket ---
  document.getElementById('randomPoll').addEventListener('click', async () => {
    try {
      const res = await fetch('/anketler.json', { cache: 'no-store' });
      if (!res.ok) throw new Error('no list');
      const list = await res.json();
      const items = (Array.isArray(list) ? list : []).filter(x => x && x.link);
      const pick = items.length ? items[Math.floor(Math.random() * items.length)].link : null;
      location.href = pick || '/anketler/anket-1.html';
    } catch (_) {
      location.href = '/anketler/anket-1.html';
    }
  });

  // --- (Opsiyonel) Ana sayfaya bir miktar anket kartı doldur + içerik içi reklam ---
  (async () => {
    const grid = document.getElementById('pollGrid');
    if (!grid) return;
    try {
      const res = await fetch('/anketler.json');
      if (!res.ok) return;
      const list = await res.json();
      (list || []).slice(0, 12).forEach((it, i) => {
        if (!it?.link) return;
        const card = document.createElement('a');
        card.className = 'card';
        card.href = it.link;
        card.setAttribute('role', 'listitem');
        card.innerHTML = `
          <img src="${it.image || '/assets/og-banner.jpg'}" alt="${it.title || 'Anket'}" loading="lazy" />
          <div class="card-body">
            <h3>${it.title || 'Anket'}</h3>
            <p>${it.desc || ''}</p>
          </div>
        `;
        grid.appendChild(card);

        // her 3 karttan sonra 1 içerik içi reklam
        if ((i + 1) % 3 === 0) {
          const ad = document.createElement('div');
          ad.className = 'ad infeed';
          ad.innerHTML = `
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-XXXXXXXXXXXXXXX"
                 data-ad-slot="4567890123"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>`;
          grid.appendChild(ad);
          try { (adsbygoogle = window.adsbygoogle || []).push({}); } catch(e) {}
        }
      });
    } catch(e) { /* sessiz geç */ }
  })();
  </script>
</body>
</html>
