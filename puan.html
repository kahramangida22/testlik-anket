<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Puanƒ±m | Testlik</title>
  <meta name="description" content="Toplam puanƒ±nƒ± ger√ßek zamanlƒ± g√∂r√ºnt√ºle." />
  <link rel="canonical" href="https://testlik.com/puan.html" />
  <link rel="stylesheet" href="css/style.css" />
  <!-- AdSense (isteƒüe baƒülƒ±) -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXX" crossorigin="anonymous"></script>

  <!-- Firebase boot (ESM) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js';
    import { getAnalytics }  from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-analytics.js';
    import { getAuth }       from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js';
    import { getFirestore }  from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDcneigub2eAJjTrfrkiETuLgy5ule8L6s",
      authDomain: "testlik.firebaseapp.com",
      projectId: "testlik",
      storageBucket: "testlik.firebasestorage.app",
      messagingSenderId: "668524500496",
      appId: "1:668524500496:web:579bb4fc5990c87afedc95",
      measurementId: "G-8ZEYBJCV3T"
    };

    const app = initializeApp(firebaseConfig);
    window.fb = {
      app,
      analytics: getAnalytics(app),
      auth: getAuth(app),
      db: getFirestore(app)
    };
  </script>
</head>
<body>
  <header class="navbar">
    <a class="logo" href="index.html">üó≥Ô∏è Testlik</a>
    <nav class="topnav">
      <a href="index.html">Anketler</a>
      <a href="oduller.html">√ñd√ºller</a>
    </nav>
    <button id="authBtn" class="btn ghost">Giri≈ü</button>
  </header>

  <main class="wrap">
    <section class="grid-area" style="max-width:720px;margin:0 auto;text-align:center;">
      <h1>Toplam Puanƒ±n</h1>
      <div id="puanAlani" style="font-size:42px;color:#7cc1ff;font-weight:800;">‚Äî</div>
      <p id="puanDurum" style="color:#9fb3ff">Puanlar y√ºkleniyor‚Ä¶</p>

      <div class="ad">
        <ins class="adsbygoogle" style="display:block"
             data-ad-client="ca-pub-XXXXXXXXXXXXXXX"
             data-ad-slot="4567890123"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div class="ad ad-footer">
      <ins class="adsbygoogle" style="display:block"
           data-ad-client="ca-pub-XXXXXXXXXXXXXXX"
           data-ad-slot="3456789012"
           data-ad-format="link"
           data-full-width-responsive="true"></ins>
      <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
    </div>
  </footer>

  <!-- Auth (Giri≈ü/√áƒ±kƒ±≈ü butonu) -->
  <script type="module" src="js/auth.js"></script>

  <!-- Firestore'dan puanƒ± oku (ger√ßek zamanlƒ±) -->
  <script type="module">
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js';
    import { doc, onSnapshot }    from 'https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js';

    const auth = window.fb.auth;
    const db   = window.fb.db;

    const puanEl   = document.getElementById('puanAlani');
    const durumEl  = document.getElementById('puanDurum');

    onAuthStateChanged(auth, (user) => {
      if (!user) {
        puanEl.textContent = '‚Äî';
        durumEl.textContent = 'Puanlarƒ±nƒ± g√∂rmek i√ßin giri≈ü yap.';
        return;
      }
      durumEl.textContent = ' ';
      const userRef = doc(db, 'users', user.uid);
      onSnapshot(userRef, (snap) => {
        const data = snap.data();
        puanEl.textContent = (data?.totalPoints ?? 0);
      }, (err) => {
        console.error(err);
        durumEl.textContent = 'Puanlar okunamadƒ±.';
      });
    });
  </script>
</body>
</html>
